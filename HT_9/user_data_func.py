import sqlite3import ATMfrom time import sleepfrom itertools import combinations_with_replacementclass StopLoop(Exception):    passdef tables():    try:        with sqlite3.connect('bankom.db') as db:            cursor = db.cursor()            cursor.execute("""CREATE TABLE IF NOT EXISTS users_data(id INTEGER, user TEXT,                             password INTEGER, admin	TEXT, PRIMARY KEY("id" AUTOINCREMENT)) """)            cursor.execute('''CREATE TABLE balance (id INTEGER, user TEXT, balance INTEGER, PRIMARY KEY("id" AUTOINCREMENT))''')            cursor.execute(''' CREATE TABLE banknote ("id" INTEGER, "banknote" INTEGER,                            "amount" INTEGER, PRIMARY KEY("id" AUTOINCREMENT)) ''')            cursor.execute('''CREATE TABLE operation (id INTEGER, user TEXT,                                         operation TEXT, status TEXT, PRIMARY KEY("id" AUTOINCREMENT))''')        return    except sqlite3.OperationalError:        returndef user_check():        with sqlite3.connect('bankom.db') as db:  # db, db3, sqlite, sqlite3            cursor = db.cursor()            cursor.execute("""SELECT user FROM users_data""")            if cursor.fetchone() is None:                cursor.close()                return add_user()        return "Есть зарегистрированые пользователи"def withdraw_cash(name):    my_balance = user_balance(name)    depo = abs(int(input("Введите сумму для снятия:\n")))    if depo < my_balance and (my_balance + depo) > 0:        if ATM.atm_cash() >= depo:            some_val = withdraw(depo)            if some_val is not False:                if with_dict(some_val) is True:                    print(f"Выдано банкнот:")                    for k, v in some_val.items():                        print(f"{k} - {v}")                    print()                    ATM.withdraw_banknote(some_val, ATM.remainder())                    new_balance = my_balance - depo                    with sqlite3.connect('bankom.db') as db:  # db, db3, sqlite, sqlite3                        cursor = db.cursor()                        cursor.execute("UPDATE balance SET balance == ? WHERE user == ?",                                       (new_balance, name,)).fetchone()                        cursor.execute("""INSERT INTO operation (user, operation, status, amount)                                                 VALUES(?, ?, ?, ?)""", (name, 'withdraw', 'success', depo))                    return depo, new_balance                else:                    print(f"Банкомат не может выдать выбраную сумму\n"                          f"Выберете с доступных номиналов\n{ATM.balance_banknotes()}")                    with sqlite3.connect('bankom.db') as db:  # db, db3, sqlite, sqlite3                        cursor = db.cursor()                        cursor.execute("""INSERT INTO operation (user, operation, status, amount)                                         VALUES(?, ?, ?, ?)""", (name, 'withdraw', 'denied', depo))                        db.commit()            else:                print(f"Банкомат не может выдать выбраную сумму\n"                      f"Выберете с доступных номиналов\n{ATM.balance_banknotes()}")                with sqlite3.connect('bankom.db') as db:  # db, db3, sqlite, sqlite3                    cursor = db.cursor()                    cursor.execute("""INSERT INTO operation (user, operation, status, amount)                                 VALUES(?, ?, ?, ?)""", (name, 'withdraw', 'denied', depo))        else:            print(f"Банкомат не может выдать выбраную сумму\n"                  f"Недостаточно денег в банкомате!")            with sqlite3.connect('bankom.db') as db:                cursor = db.cursor()                cursor.execute("""INSERT INTO operation (user, operation, status, amount)                                 VALUES(?, ?, ?, ?)""", (name, 'withdraw', 'denied', depo))    else:        print(f"Недостаточно денег на счету!\n"              f"На Вашем счету {user_balance(name)}")        with sqlite3.connect('bankom.db') as db:            cursor = db.cursor()            cursor.execute("""INSERT INTO operation (user, operation, status, amount)                             VALUES(?, ?, ?, ?)""", (name, 'withdraw', 'denied', depo))        return Falsedef deposite(name):    my_balance = user_balance(name)    depo = abs(int(input("Введите сумму вложения:\n")))    new_balance = my_balance + depo    with sqlite3.connect('bankom.db') as db:  # db, db3, sqlite, sqlite3        cursor = db.cursor()        cursor.execute("UPDATE balance SET balance == ? WHERE user == ?",                       (new_balance, name,)).fetchone()    with sqlite3.connect('bankom.db') as db:  # db, db3, sqlite, sqlite3        cursor = db.cursor()        cursor.execute("""INSERT INTO operation (user, operation, status, amount)                         VALUES(?, ?, ?, ?)""", (name, 'deposite', 'success', depo))    return depo, new_balancedef with_dict(another):    with sqlite3.connect('bankom.db') as db:        cursor = db.cursor()        bank_dict = cursor.execute("SELECT banknote, amount FROM banknote").fetchall()        out_dict = {}        for keyval in bank_dict:            out_dict[keyval[0]] = keyval[1]  # [dict]        banknotes = {}        for k, v in out_dict.items():            banknotes[int(k)] = v        #bool_val = False        for key in another:            if another[key] <= banknotes[key]:                pass            else:                return False        return Truedef user_balance(name):    with sqlite3.connect('bankom.db') as db:  # db, db3, sqlite, sqlite3        cursor = db.cursor()        valid = cursor.execute("SELECT balance FROM balance WHERE user == ?", (name,)).fetchone()        for row in valid:            balance = row        sleep(0.2)        return int(balance)def banknotes_value():    with sqlite3.connect('bankom.db') as db:        cursor = db.cursor()        bank_dict = cursor.execute("SELECT banknote, amount FROM banknote").fetchall()        output_dict = {}        for keyval in bank_dict:            output_dict[keyval[0]] = keyval[1]        return output_dictdef withdraw(depo):    money_count = depo    del_list = []    final_value = {}    count_loop = 7    while depo > 0:        if count_loop != 0:            try:                take_banknotes = {}                # Формирование словаря с доступными купюрами                banknotes = banknotes_value()                bank_note = banknotes.copy()                for key, val in banknotes.items():                    if val == 0:                        bank_note.pop(key)                # Формирование списка доступных купюр                a = []                for index in bank_note.keys():                    a.append(index)                for i in del_list:                    a.remove(i)                a.sort(reverse=True)                #Счетчик цикла. Выход из цикла                count_loop -= 1                # Цикл перебор номиналов                cycles = [depo // v for v in a]                for combine in range(1, sum(cycles) + 1):                    for combinations in combinations_with_replacement(a, combine):                        # Проверка оминалов на наличие                        if sum(combinations) == depo:                            for line in combinations:                                take_banknotes[line] = combinations.count(line)                            for k, v in take_banknotes.items():                                for key, val in banknotes.items():                                    if k == key and v <= val:                                        final_value[k] = v                                        break                                    elif k == key and v > val:                                        final_value[k] = val                                        del_list.append(key)                                final_list = sum([key * value for key, value in final_value.items()])                                depo = money_count - final_list                                raise StopLoop            except StopLoop:                pass        else:            return False    return final_valuedef add_user():    try:        print("\nСоздаем новую учетную запись!\n")        name = input("Введите имя нового пользователя:\n")        password = input("Введите пароль нового пользователя:\n")        admin = input("Доступ к меню администратора (True or False):\n")        with sqlite3.connect('bankom.db') as db:            cursor = db.cursor()            valid = cursor.execute("SELECT user FROM users_data").fetchall()            if (name,) not in valid:                cursor.execute("""INSERT INTO users_data (user, password, admin)                 VALUES( ?, ?, ?)""", (name, password, admin))                db.commit()            balance = int(input("Сумма баланса нового пользователя\n"))            cursor.execute("""INSERT INTO balance(user, balance) VALUES(?, ?)""", (name, balance))            return ("\nОперация успешная\n"                    "Пользователь добавлен!\n")    except ValueError:        print("\nНе правильный ввод!!!\n")        return "\nНе верная операция!\n"